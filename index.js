const TelegramBot = require("node-telegram-bot-api");
const schedule = require("node-schedule");
require("dotenv").config();

const token = process.env.TELEGRAM_BOT_TOKEN;
const bot = new TelegramBot(token, { polling: true });

let usersState = {}; // –§–æ—Ä–º–∞—Ç: { chatId: { day, step, startDate, lastActive, paymentStatus } }

const paymentLink = "https://www.liqpay.ua/..."; // –°—é–¥–∏ –≤—Å—Ç–∞–≤–∏–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–ø–ª–∞—Ç—É

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–ø–ª–∞—Ç–∏ (–ø–æ–∫–∏ —â–æ –ø—Ä–æ—Å—Ç–æ —ñ–º—ñ—Ç–∞—Ü—ñ—è, –ø–æ—Ç—ñ–º –∑–∞–º—ñ–Ω–∏–º–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç –¥–æ LiqPay API)
const checkPayment = async (chatId) => {
  // –¢—É—Ç –º–∞—î –±—É—Ç–∏ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂—É —á–µ—Ä–µ–∑ API LiqPay
  return true; // –ü–æ–∫–∏ —â–æ –ø—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ –æ–ø–ª–∞—Ç–∞ –∑–∞–≤–∂–¥–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Å–ø—ñ—à–Ω–æ
};

// –ü—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–Ω–æ–ø–∫–æ—é –æ–ø–ª–∞—Ç–∏
bot.onText(/\/start/, async (msg) => {
  const chatId = msg.chat.id;

  if (usersState[chatId] && usersState[chatId].paymentStatus) {
    bot.sendMessage(chatId, "–í–∏ –≤–∂–µ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫—É—Ä—Å—É!");
    sendStep(chatId);
    return;
  }

  usersState[chatId] = { paymentStatus: false };

  bot.sendMessage(
    chatId,
    "–ü—Ä–∏–≤—ñ—Ç! –í—ñ—Ç–∞—é –≤–∞—Å –Ω–∞ –∫—É—Ä—Å—ñ '–®–ª—è—Ö –¥–æ —Å–ø–æ–∫–æ—é: —è–∫ —à–≤–∏–¥–∫–æ –ø–æ–∑–±—É—Ç–∏—Å—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫'! üòä\n\n" +
      "–î–ª—è —Ç–æ–≥–æ, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É '–î–û–°–¢–£–ü' —Ç–∞ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –±–µ–∑–ø–µ—á–Ω–æ—ó —Ñ–æ—Ä–º–∏ –æ–ø–ª–∞—Ç–∏.",
    {
      reply_markup: {
        inline_keyboard: [[{ text: "–î–û–°–¢–£–ü", url: paymentLink }]],
      },
    }
  );

  setTimeout(() => checkPaymentStatus(chatId), 30000); // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
});

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –æ–ø–ª–∞—Ç–∏
const checkPaymentStatus = async (chatId) => {
  const isPaid = await checkPayment(chatId);
  if (isPaid) {
    usersState[chatId].paymentStatus = true;
    usersState[chatId].day = 1;
    usersState[chatId].step = 0;
    usersState[chatId].startDate = new Date();
    usersState[chatId].lastActive = new Date();

    bot.sendMessage(
      chatId,
      "‚úÖ –í—ñ—Ç–∞—é, –≤–∞—à–∞ –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ! –î–æ—Å—Ç—É–ø –≤—ñ–¥–∫—Ä–∏—Ç–æ. –ü–æ—á–∏–Ω–∞—î–º–æ –Ω–∞–≤—á–∞–Ω–Ω—è! üöÄ"
    );
    sendStep(chatId);
  } else {
    bot.sendMessage(
      chatId,
      "‚ùå –©–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ —Å–≤–æ–≥–æ –±–∞–Ω–∫—É."
    );
  }
};

// –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—ñ–¥–µ–æ —Ç–∞ —Ñ–∞–π–ª–∏
const courseContent = [
  {
    day: 1,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1sTwVJw94iZS8mvoRLlA3hqAcm3m-hdTQ",
        text: "–°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –∑ –≤–∞–º–∏ –∑–Ω–∞–π–æ–º–∏–º–æ—Å—è. üòá –ú–µ–Ω–µ –∑–≤—É—Ç—å –ö—ñ—Ä–∞ –Ü–≤–ª—î–≤–∞. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—ñ–¥–µ–æ, —É —è–∫–æ–º—É —è —Ä–æ–∑–ø–æ–≤—ñ–º –ø—Ä–æ —Å–µ–±–µ —Ç–∞ –ø—Ä–æ –∫—É—Ä—Å.",
        video: "https://youtu.be/JVX3zmS5tmk",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¢–µ–ø–µ—Ä, –ø—ñ—Å–ª—è –Ω–∞—à–æ–≥–æ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞, —è —Ö–æ—á—É –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–æ–∑–ø–æ–≤—ñ—Å—Ç–∏ –≤–∞–º –ø—Ä–æ –ø–∞–Ω—ñ—á–Ω—ñ –∞—Ç–∞–∫–∏. –ü–µ—Ä–µ—Ö–æ–¥—å—Ç–µ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º. üß†‚ú®",
        video: "https://youtu.be/6g5zq2mW4Ks",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–ê —Ç–µ–ø–µ—Ä –ø—Ä–æ—à—É –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—É —Ñ–æ—Ä–º—É. üìù –¶–µ –¥–æ–ø–æ–º–æ–∂–µ –º–µ–Ω—ñ –æ—Ü—ñ–Ω–∏—Ç–∏ –≤–∞—à —Å—Ç–∞–Ω —ñ –ø–æ—Ç—Ä–µ–±–∏. –î—è–∫—É—é! üíï",
        image:
          "https://drive.google.com/uc?export=download&id=12MT2L75unoay45CUwBKrQBF8pZEGu9xB",
        form: "https://docs.google.com/forms/d/e/1FAIpQLSci3Qdk-sIb6Gbgthd4KpeEhxnRtb3oG7yslV5XTHgW41UcVw/viewform?usp=sf_link",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
      },
    ],
  },
  {
    day: 2,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1V5pz4A5-3tDtZHN0PAiF_vEZT3YybGPB",
        text: "–í—ñ—Ç–∞—é! –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ —Ä–æ–∑–ø–æ—á–∏–Ω–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω—É —Ä–æ–±–æ—Ç—É. üöÄ –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –≤—ñ–¥–µ–æ, —â–æ–± –∫—Ä–∞—â–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –≤–∞—à–µ —Ç—ñ–ª–æ, –µ–º–æ—Ü—ñ—ó —Ç–∞ –¥—É–º–∫–∏ —Ä–µ–∞–≥—É—é—Ç—å –Ω–∞ —Å—Ç—Ä–µ—Å. üß†",
        image:
          "https://drive.google.com/uc?export=download&id=15VVe8-itCltcYtNA29_3d7bJJIkDVbgB",
        video: "https://youtu.be/ibpoVB_YsB4",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—Ä–æ–ø–æ–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏! üßò‚Äç‚ôÄÔ∏è –£ —Ü—å–æ–º—É –≤—ñ–¥–µ–æ –º–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å –≤–ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ö–∞–Ω–Ω—è —Ç–∞ –ø–æ–ø—Ä–∞–∫—Ç–∏–∫—É—î–º–æ —Ç–µ—Ö–Ω—ñ–∫—É '–¥—ñ–∞—Ñ—Ä–∞–≥–º–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ö–∞–Ω–Ω—è'.",
        image:
          "https://drive.google.com/uc?export=download&id=1bRWjuXtSzx3SpfJ8M9464CGtjhnnsjH5",
        video: "https://youtu.be/2yatrw0CzgE",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
      },
    ],
  },
  {
    day: 3,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1PRCk4eyUd-UlTOCqg209pjPBILMwZai_",
        text: "–ü—Ä–∏–≤—ñ—Ç! üåä –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –ø–æ–Ω—è—Ç—Ç—è '–•–≤–∏–ª—è —Å—Ç—Ä–µ—Å—É'. –¶–µ –¥–æ–ø–æ–º–æ–∂–µ –∫—Ä–∞—â–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ —Å—Ç—Ä–µ—Å –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ç—ñ–ª–æ —ñ –ø—Å–∏—Ö—ñ–∫—É. üß†üí°",
        image:
          "https://drive.google.com/uc?export=download&id=1EqClmgrewDoJLvZJzX_-vlPCOF2VAgzE",
        video: "https://youtu.be/2IXCtmOFxI0",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏! üßò‚Äç‚ôÇÔ∏è –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –Ω–∞–≤—á–∏–º–æ—Å—è –≤–ø—Ä–∞–≤–∞–º –∑–∞–∑–µ–º–ª–µ–Ω–Ω—è, —è–∫—ñ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –∑–Ω–∏–∑–∏—Ç–∏ —Å–∏–º–ø—Ç–æ–º–∏ –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫. –ü–µ—Ä–µ—Ö–æ–¥—å—Ç–µ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º!",
        image:
          "https://drive.google.com/uc?export=download&id=109ZYdKvAzn6cwL9SSPavWFE5-1egKdTE",
        video: "https://youtu.be/Qrm21OWm1Gk",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
      },
    ],
  },
  {
    day: 4,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1g9fHmFdDDn5j5p-xnj6X1wFtvaky6Lt6",
      },
      {
        text: "–í—ñ—Ç–∞—é! üß† –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ —Ç–µ, —è–∫ —Ç—Ä–∏–≥–µ—Ä–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å –ø–∞–Ω—ñ—á–Ω—É –∞—Ç–∞–∫—É —Ç–∞ —á–æ–º—É –≤–∏–Ω–∏–∫–∞—î –ø–∞–Ω—ñ—á–Ω–∏–π —Ä–æ–∑–ª–∞–¥.",
        image:
          "https://drive.google.com/uc?export=download&id=1B9WGz97GhW1lcUH1E1Fm7ClU75ATZn-P",
        video: "https://youtu.be/_lSblgI7PTI",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏! üìù –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤–ø—Ä–∞–≤—É, —è–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –∑–Ω–∞–π—Ç–∏ –≤–ª–∞—Å–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏ —Ç–∞ –Ω–∞–≤—á–∏—Ç–∏—Å—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏ —ó—Ö –Ω–∞ —Ä–∞–Ω–Ω—ñ—Ö –µ—Ç–∞–ø–∞—Ö.",
        image:
          "https://drive.google.com/uc?export=download&id=1Hk_mFmTLEIMVHKBu3f81b-y5Rdqb2r1X",
        video: "https://youtu.be/cac0iNstWs4",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
      },
    ],
  },
  {
    day: 5,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1iFP08yiKCoT1sPfMDyESnBiFzTMqjsTv",
        text: "–ü—Ä–∏–≤—ñ—Ç! üßò‚Äç‚ôÄÔ∏è –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ —ñ–Ω—à—ñ —Ñ–∞–∫—Ç–æ—Ä–∏, —è–∫—ñ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫: —Å—Ç–æ—Å—É–Ω–∫–∏ —Ç–∞ —Å–ø–æ—Å—ñ–± –∂–∏—Ç—Ç—è. ü§ù",
        image:
          "https://drive.google.com/uc?export=download&id=1yN1yaqjwBGFA1lUcQWHfC-qZYNKh3RPU",
        video: "https://youtu.be/MI_tZpO9ijw",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ! üåü –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤–ø—Ä–∞–≤—É '–¢—Ä–∏ –∫–æ–ª–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó', —è–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ –∫—Ä–∞—â–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –≤–∞—à—ñ —Å—Ç–æ—Å—É–Ω–∫–∏ —Ç–∞ —ó—Ö–Ω—ñ–π –≤–ø–ª–∏–≤ –Ω–∞ –≤–∞—Å.",
        image:
          "https://drive.google.com/uc?export=download&id=1FyZvUDMRbyorn5HRnbdyNwIu5tguOvYw",
        video: "https://youtu.be/8cnw4hhrJcM",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–Ω—è ‚Äî —Ç–µ—Ö–Ω—ñ–∫–∞ –∑–∞–∑–µ–º–ª–µ–Ω–Ω—è, —è–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ —Å—Ç–∞–±—ñ–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–µ—Ä–≤–æ–≤—É —Å–∏—Å—Ç–µ–º—É. üßò‚Äç‚ôÄÔ∏è",
        image:
          "https://drive.google.com/uc?export=download&id=1hd__0_VS1khiY1j1-9o63414Yd6DWkwX",
        video: "https://youtu.be/yl9-wwrwHGU",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
      },
    ],
  },
  {
    day: 6,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1JQ9dahfa9HpvsEEeQezRMrxZvyuzaJ56",
        text: "–ü—Ä–∏–≤—ñ—Ç! –°—å–æ–≥–æ–¥–Ω—ñ —è —Ö–æ—á—É –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è —Å–≤–æ—î—é —ñ—Å—Ç–æ—Ä—ñ—î—é ‚Äî –≤–ª–∞—Å–Ω–∏–º –¥–æ—Å–≤—ñ–¥–æ–º –ø–æ–¥–æ–ª–∞–Ω–Ω—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫. üåü",
        image:
          "https://drive.google.com/uc?export=download&id=1O_z9DBMdAGTIzUFZTovaJ6IsTDw_iUR7",
        video: "https://youtu.be/hMeFFsQQ4Lg",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏ –º–µ–¥–∏—Ç–∞—Ü—ñ—ó. üßò‚Äç‚ôÄÔ∏è –ü—Ä–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –≤–æ–Ω–∞ –¥–æ–ø–æ–º–æ–∂–µ –∑–Ω–∏–∑–∏—Ç–∏ —Ç—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å. –ü–æ—á–Ω–µ–º–æ –∑–∞—Ä–∞–∑!",
        image:
          "https://drive.google.com/uc?export=download&id=10TnK7L-I5OBsVUFWWevV3eCxQV8LzPO1",
        video: "https://youtu.be/3Qar8yR5jt0",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
      },
    ],
  },
  {
    day: 7,
    steps: [
      {
        image:
          "https://drive.google.com/uc?export=download&id=1gp7gGCIVx47RcuxrikQooguuCBd24o3p",
        text: "–í—ñ—Ç–∞—é! üéâ –í–∏ –¥—ñ–π—à–ª–∏ –¥–æ —Ñ—ñ–Ω–∞–ª—É –∫—É—Ä—Å—É '–®–ª—è—Ö –¥–æ —Å–ø–æ–∫–æ—é: —è–∫ —à–≤–∏–¥–∫–æ –ø–æ–∑–±—É—Ç–∏—Å—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫'. –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø—ñ–¥—Å—É–º—É—î–º–æ –≤—Å—ñ –∑–Ω–∞–Ω–Ω—è —Ç–∞ —Ç–µ—Ö–Ω—ñ–∫–∏, —è–∫—ñ –≤–∏ –æ–ø–∞–Ω—É–≤–∞–ª–∏.",
        image:
          "https://drive.google.com/uc?export=download&id=1ZKxmpWEJ1bpsbLVI2vwpRGzo_ZLiXB0t",
        video: "https://youtu.be/sPv3oX8aQBU",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å–æ–±—ñ –ß–µ–∫-–ª–∏—Å—Ç! –í—ñ–Ω –¥–æ–ø–æ–º–æ–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ –∑–Ω–∞–Ω–Ω—è, —è–∫—ñ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –ø—ñ–¥ —á–∞—Å –∫—É—Ä—Å—É. üìö",
        pdf: "https://drive.google.com/uc?export=download&id=1FO9Bq9s-RdR0oXyCQRc0Ndtli022t5l_",
      },

      {
        text: "–î–ª—è —Ä–µ–ª–∞–∫—Å—É –ø—Ä–æ–≤–µ–¥–µ–º–æ –∞–≤—Ç–æ—Ä—Å—å–∫—É –º–µ–¥–∏—Ç–∞—Ü—ñ—é '–ó—ñ—Ä–∫–∞'. üßò‚Äç‚ôÄÔ∏è –í–æ–Ω–∞ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º —Ä–æ–∑—Å–ª–∞–±–∏—Ç–∏—Å—è —Ç–∞ –≤—ñ–¥—á—É—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å–ø–æ–∫—ñ–π.",
        image:
          "https://drive.google.com/uc?export=download&id=17ulC4z3LbFZgfYmEmrkEh4OiNCZQ2CPC",
        video: "https://youtu.be/pk8_7tBcRuU",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },
      {
        text: "–ù–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è ‚Äî —Ç–µ—Ö–Ω—ñ–∫–∞ '–ü–æ–¥—è–∫–∞'. üíï –í–æ–Ω–∞ –¥–æ–ø–æ–º–æ–∂–µ –∫—Ä–∞—â–µ —Å–ø—Ä–∞–≤–ª—è—Ç–∏—Å—è –∑—ñ —Å—Ç—Ä–µ—Å–æ–º —ñ —Ç—Ä–∏–≤–æ–≥–æ—é.",
        image:
          "https://drive.google.com/uc?export=download&id=1lD9BGL9NrdckmBFewH2xNGdh4JNbxWfJ",
        video: "https://youtu.be/dsTbpMFcXko",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É üé•",
      },

      {
        text: "–ë–æ–Ω—É—Å! üé∂ –¢—Ä–∏ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ñ —Ç—Ä–µ–∫–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:",
        audio: [
          "https://drive.google.com/uc?export=download&id=1H6mYLTeM5CqxYysp5XCvgSjQGBNF1WUh",
          "https://drive.google.com/uc?export=download&id=1CnyeqPngvYpOTFq1R48papoq31yVIdEt",
          "https://drive.google.com/uc?export=download&id=1kXv3xkNwoxZTg9oGSPdrvzWv0sJnGknf",
        ],
      },
      {
        text: "–¶–µ —â–µ –Ω–µ –≤—Å–µ! –Ø –ø—ñ–¥–≥–æ—Ç—É–≤–∞–ª–∞ –ø–∞–º'—è—Ç–∫—É, —è–∫—É –í–∏ –∑–º–æ–∂–µ—Ç–µ —Ä–æ–∑–¥—Ä—É–∫—É–≤–∞—Ç–∏. –í–∏–∫–æ–Ω—É–π—Ç–µ —Ü—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —ñ –ø–∞–Ω—ñ—á–Ω–∞ –∞—Ç–∞–∫–∞ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–∞—Ö–æ–ø–∏—Ç—å –∑–Ω–µ–Ω–∞—Ü—å–∫–∞! üìö",
        pdf: "https://drive.google.com/uc?export=download&id=1Mzt49TW9AoOxzwNiyWCAwecPLvHOBrdv",
      },
      {
        text: "–Ü —Ü–µ —â–µ –Ω–µ –≤—Å–µ! –¶–µ –ø–∞–º'—è—Ç–∫–∞, —è–∫ –ø–æ–≤–æ–¥–∏—Ç–∏—Å—è –ø—ñ–¥ —á–∞—Å –ø–∞–Ω—ñ—á–Ω–æ—ó –∞—Ç–∞–∫–∏! –ó–∞–ø–∞–º—è—Ç–∞–π—Ç–µ, —Ç—ñ–ª—å–∫–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –¥–æ–ø–æ–º–æ–∂—É—Ç—å —à–≤–∏–¥–∫–æ –ø–æ–¥–æ–ª–∞—Ç–∏ –ø–∞–Ω—ñ—á–Ω—É –∞—Ç–∞–∫—É —Ç–∞ –ø–æ–∑–±—É—Ç–∏—Å—è —ó—Ö –Ω–∞–∑–∞–≤–∂–¥–∏! üìö",
        pdf: "https://drive.google.com/uc?export=download&id=1d-kZ3tWUF8exHB9e77ExVu4-PTJ0dptl",
      },
      {
        text: "–î—è–∫—É—é, —â–æ –±—É–ª–∏ –∑—ñ –º–Ω–æ—é –Ω–∞ —Ü—å–æ–º—É —à–ª—è—Ö—É! ‚ù§ –ë–∞–∂–∞—é –≤–∞–º –≥–∞—Ä–º–æ–Ω—ñ—ó —Ç–∞ —Å–ø–æ–∫–æ—é.",
      },
    ],
  },
];

// –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
const sendStep = async (chatId) => {
    const userState = usersState[chatId];
    if (!userState || !userState.paymentStatus) return;

    const { day, step } = userState;
    const todayContent = courseContent.find((content) => content.day === day);

    if (!todayContent || !todayContent.steps[step]) {
        bot.sendMessage(chatId, "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00. üòä");
        return;
    }

    const currentStep = todayContent.steps[step];
    if (currentStep.image) await bot.sendPhoto(chatId, currentStep.image);
    if (currentStep.text) await bot.sendMessage(chatId, currentStep.text);
    if (currentStep.video) {
        await bot.sendMessage(chatId, `–î–∏–≤–∏—Å—å –≤—ñ–¥–µ–æ —Ç—É—Ç: ${currentStep.video}`, {
            reply_markup: { inline_keyboard: [[{ text: currentStep.button, url: currentStep.video }]] },
        });
    }
    if (currentStep.audio) {
        if (Array.isArray(currentStep.audio)) {
            for (const audio of currentStep.audio) {
                await bot.sendAudio(chatId, audio);
            }
        } else {
            await bot.sendAudio(chatId, currentStep.audio);
        }
    }
    if (currentStep.pdf) await bot.sendDocument(chatId, currentStep.pdf);
    if (currentStep.form) await bot.sendMessage(chatId, `–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É —Ç—É—Ç: ${currentStep.form}`);

    if (todayContent.steps[step + 1]) {
        bot.sendMessage(chatId, "–ö–æ–ª–∏ –±—É–¥–µ—à –≥–æ—Ç–æ–≤–∏–π, –Ω–∞—Ç–∏—Å–Ω–∏ '–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏'!", {
            reply_markup: { inline_keyboard: [[{ text: "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏", callback_data: "continue" }]] },
        });
    }
};

// –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"
bot.on("callback_query", (query) => {
    const chatId = query.message.chat.id;
    if (query.data === "continue") {
        usersState[chatId].step += 1;
        sendStep(chatId);
    }
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–æ–∑—Å–∏–ª–∫–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ –æ 18:00, —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–µ—Ä—à–∏–≤ —É—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
schedule.scheduleJob("0 18 * * *", () => {
    for (const chatId in usersState) {
        const userState = usersState[chatId];
        if (userState.paymentStatus && userState.step === courseContent.find((c) => c.day === userState.day).steps.length) {
            userState.day += 1;
            userState.step = 0;
            sendStep(chatId);
        }
    }
});
