const TelegramBot = require("node-telegram-bot-api");
const schedule = require("node-schedule");

// –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞
require("dotenv").config();
const token = process.env.TELEGRAM_BOT_TOKEN;
const bot = new TelegramBot(token, { polling: true });

// –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: –∑–±–µ—Ä—ñ–≥–∞—î, –Ω–∞ —è–∫–æ–º—É –∫—Ä–æ—Ü—ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∫–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
let usersState = {}; // –§–æ—Ä–º–∞—Ç: { chatId: { day: number, step: number } }

// –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—ñ–¥–µ–æ —Ç–∞ —Ñ–∞–π–ª–∏
const courseContent = [
  {
    day: 1,
    steps: [
      {
        text: "–°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –∑ –≤–∞–º–∏ –∑–Ω–∞–π–æ–º–∏–º–æ—Å—è, —Ç–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º, –≤ —Ü—å–æ–º—É –≤—ñ–¥–µ–æ —è —Ä–æ–∑–ø–æ–≤—ñ–º —Ç–æ–±—ñ –ø—Ä–æ —Å–µ–±–µ —Ç–∞ –ø—Ä–æ –∫—É—Ä—Å.",
        video: "https://youtu.be/JVX3zmS5tmk",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—ñ—Å–ª—è –Ω–∞—à–æ–≥–æ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞ —è —Ö–æ—á—É –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–æ–∑–∫–∞–∑–∞—Ç–∏ —Ç–æ–±—ñ –ø—Ä–æ –ø–∞–Ω—ñ—á–Ω—ñ –∞—Ç–∞–∫–∏. –ü–µ—Ä–µ—Ö–æ–¥—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º.",
        video: "https://youtu.be/6g5zq2mW4Ks",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–ê —Ç–µ–ø–µ—Ä —è –ø—Ä–æ—à—É —Ç–µ–±–µ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—É —Ñ–æ—Ä–º—É, —â–æ–± —è –∑–º–æ–≥–ª–∞ –æ—Ü—ñ–Ω–∏—Ç–∏ —Ç–≤—ñ–π —Å—Ç–∞–Ω —ñ –ø–æ—Ç—Ä–µ–±–∏.",
        image: "./covers/google_form.jpg",
        form: "https://docs.google.com/forms/d/e/1FAIpQLSci3Qdk-sIb6Gbgthd4KpeEhxnRtb3oG7yslV5XTHgW41UcVw/viewform?usp=sf_link",
      },

      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä",
      },
    ],
  },
  {
    day: 2,
    steps: [
      {
        text: "–í—ñ—Ç–∞—é! –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ —Ä–æ–∑–ø–æ—á–∏–Ω–∞—î–º–æ —Å —Ç–æ–±–æ—é –∞–∫—Ç–∏–≤–Ω—É –ø—Ä–∞—Ü—é! –°–ø–æ—á–∞—Ç–∫—É –ø–æ–¥–∏–≤–∏—Å—å –≤—ñ–¥–µ–æ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —è–∫ —Ç–≤–æ—î —Ç—ñ–ª–æ, –µ–º–æ—Ü—ñ—ó —Ç–∞ –¥—É–º–∫—Ç –º–æ–∂—É—Ç—å —Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ —Å—Ç—Ä–µ—Å.",
        video: "https://youtu.be/ibpoVB_YsB4",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—Ä–æ–ø–æ–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏. –í —Ü—å–æ–º—É –ø—Ä–∞–∫—Ç–∏—á–Ω–æ–º—É —É—Ä–æ—Ü—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å –≤–ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ö–∞–Ω–Ω—è, —ó—Ö–Ω—é —Ä–æ–ª—å –≤ –ø–æ–¥–æ–ª–∞–Ω–Ω—ñ –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫ —Ç–∞ –ø–æ–ø—Ä–∞–∫—Ç–∏–∫—É—î–º–æ  —Ç–µ—Ö–Ω—ñ–∫—É ‚Äú–¥—ñ–∞—Ñ—Ä–∞–≥–º–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ö–∞–Ω–Ω—è‚Äù. –ü–µ—Ä–µ—Ö–æ–¥—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º.",
        video: "https://youtu.be/2yatrw0CzgE",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä",
      },
    ],
    files: [],
  },
  {
    day: 3,
    steps: [
      {
        text: "–í—ñ—Ç–∞—é! –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ —Ä–æ–∑–±–µ—Ä–µ–º–æ —Ç–∞–∫–µ –ø–æ–Ω—è—Ç—Ç—è, —è–∫ '–•–≤–∏–ª—è —Å—Ç—Ä–µ—Å—É' ‚Äî —Ü–µ –∫–æ—Ä–∏—Å–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—è –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ —Å—Ç—Ä–µ—Å –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ç—ñ–ª–æ —ñ –ø—Å–∏—Ö—ñ–∫—É. –í–æ–Ω–∞ –æ–ø–∏—Å—É—î –ø—Ä–∏—Ä–æ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è, —Ä–æ–∑–≤–∏—Ç–∫—É —ñ —Å–ø–∞–¥–∞–Ω–Ω—è —Ä–µ–∞–∫—Ü—ñ—ó –Ω–∞ –∑–∞–≥—Ä–æ–∑—É —Ç–∞ –Ω–µ–±–µ–∑–ø–µ–∫—É.",
        video: "https://youtu.be/2IXCtmOFxI0",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—Ä–æ–ø–æ–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏. –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ –≤–ø—Ä–∞–≤–∏  –∑–∞–∑–µ–º–ª–µ–Ω–Ω—è, —è–∫—ñ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–ª—è –∑–Ω–∏–∂–µ–Ω–Ω—è —Å–∏–º–ø—Ç–æ–º—ñ–≤ –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫ —Ç–∞ –±—É–¥–µ–º–æ –ø—Ä–∞–∫—Ç–∏–∫—É–≤–∞—Ç–∏ —Ç–µ—Ö–Ω—ñ–∫—É –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–∞—Ö.",
        video: "https://youtu.be/Qrm21OWm1Gk",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä",
      },
    ],
  },
  {
    day: 4,
    steps: [
      {
        text: "–í—ñ—Ç–∞—é! –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ —Ç–µ, —è–∫ —Ç—Ä–∏–≥–µ—Ä–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å –ø–∞–Ω—ñ—á–Ω—É –∞—Ç–∞–∫—É —ñ —á–æ–º—É –≤–∏–Ω–∏–∫–∞—î –ø–∞–Ω—ñ—á–Ω–∏–π —Ä–æ–∑–ª–∞–¥.",
        video: "https://youtu.be/_lSblgI7PTI",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—Ä–æ–ø–æ–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏. –ó–∞—Ä–∞–∑ –º–∏ –∑—Ä–æ–±–∏–º–æ –≤–ø—Ä–∞–≤—É , —è–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –∑–Ω–∞–π—Ç–∏ –≤–ª–∞—Å–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏ —Ç–∞ –Ω–∞–≤—á–∏—Ç–∏—Å—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏ —ó—Ö –Ω–∞ —Ä–∞–Ω–Ω—ñ—Ö –µ—Ç–∞–ø–∞—Ö.",
        video: "https://youtu.be/cac0iNstWs4",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä",
      },
    ],
  },
  {
    day: 5,
    steps: [
      {
        text: "–í—ñ—Ç–∞—é! –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ —Ñ–∞–∫—Ç–æ—Ä–∏, –∫—Ä—ñ–º —Ç—Ä–∏–≥–µ—Ä—ñ–≤ —ñ –ø—Å–∏—Ö–æ—Ç—Ä–∞–≤–º–∏, —è–∫—ñ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫. –ê —Å–∞–º–µ –ø—Ä–æ –≤–∞–∂–ª–∏–≤—É —Ä–æ–ª—å —Å—Ç–æ—Å—É–Ω–∫—ñ–≤ –∑ —ñ–Ω—à–∏–º–∏ –ª—é–¥—å–º–∏ —Ç–∞ —Å–ø–æ—Å–æ–±—É –∂–∏—Ç—Ç—è.",
        video: "https://youtu.be/MI_tZpO9ijw",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—Ä–æ–ø–æ–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏. –í–ø—Ä–∞–≤–∞ '–¢—Ä–∏ –∫–æ–ª–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó' –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç–æ—Å—É–Ω–∫–∏ –∑ –ª—é–¥—å–º–∏, —ñ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫—ñ –∑ —Ü–∏—Ö —Å—Ç–æ—Å—É–Ω–∫—ñ–≤ –ø—Ä–∏–Ω–æ—Å—è—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ –µ–º–æ—Ü—ñ—ó, –∞ —è–∫—ñ ‚Äî –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –Ω–∞–ø—Ä—É–≥—É –∞–±–æ —Å—Ç—Ä–µ—Å.",
        video: "https://youtu.be/8cnw4hhrJcM",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–ó–∞—Ä–∞–∑ —Ç–∏ –º–æ–∂–µ—à –≤—ñ–¥—á—É–≤–∞—Ç–∏ –Ω–µ–≤–µ–ª–∏–∫–µ –Ω–µ—Ä–≤–æ–≤–µ –∑–±—É–¥–∂–µ–Ω–Ω—è –∞–±–æ –≤–∏—Å–Ω–∞–∂–µ–Ω–Ω—è. –ü—Ä–æ–ø–æ–Ω—É—é –∑–∞—Å–ø–æ–∫–æ—ó—Ç–∏—Å—è. –î–æ–ø–æ–º–æ–∂–µ —Ç–æ–±—ñ –≤ —Ü–æ–º—É —â–µ –æ–¥–Ω–∞ –≤–ø—Ä–∞–≤–∞ –∑–∞–∑–µ–º–ª–µ–Ω–Ω—è, —è–∫–∞ —Å–ø—Ä–∏—è—î –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—é –∑–≤'—è–∑–∫–∞ —ñ–∑ —Ç—ñ–ª–æ–º —ñ —Å—Ç–∞–±—ñ–ª—ñ–∑—É—î –Ω–µ—Ä–≤–æ–≤—É —Å–∏—Å—Ç–µ–º—É.",
        video: "https://youtu.be/yl9-wwrwHGU",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä",
      },
    ],
  },
  {
    day: 6,
    steps: [
      {
        text: "–í—ñ—Ç–∞—é! –°—å–æ–≥–æ–¥–Ω—ñ —è —Ö–æ—á—É –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è —Å–≤–æ—î—é —ñ—Å—Ç–æ—Ä—ñ—î—é, –∞ —Å–∞–º–µ  –≤–ª–∞—Å–Ω–∏–º –¥–æ—Å–≤—ñ–¥–æ–º –ø–æ–¥–æ–ª–∞–Ω–Ω—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫ —Ç–∞  —à–ª—è—Ö–æ–º, —è–∫–∏–π —è –ø—Ä–æ–π—à–ª–∞ –¥–æ —Å–ø–æ–∫—ñ–π–Ω–æ–≥–æ –∂–∏—Ç—Ç—è. ",
        video: "https://youtu.be/hMeFFsQQ4Lg",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¢–µ–ø–µ—Ä –ø—Ä–æ–ø–æ–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏. –°—å–æ–≥–æ–¥–Ω—ñ —è –Ω–∞–≤—á—É —Ç–µ–±–µ —Ä–æ–±–∏—Ç–∏ –º–µ–¥–∏—Ç–∞—Ü—ñ—é. –ü—Ä–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ñ–π –ø—Ä–∞–∫—Ç–∏—Ü—ñ —É —Ç–µ–±–µ –∑–Ω–∏–∑–∏—Ç—Å—è —Ä—ñ–≤–µ–Ω—å —Ç—Ä–∏–≤–æ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ –∑'—è–≤–∏—Ç—å—Å—è –≤—ñ–¥—á—É—Ç—Ç—è –±–µ–∑–ø–µ–∫–∏.",
        video: "https://youtu.be/3Qar8yR5jt0",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞ –æ 18:00 –∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º. üòä",
      },
    ],
  },
  {
    day: 7,
    steps: [
      {
        text: "–í—ñ—Ç–∞—é —Ç–µ–±–µ —ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –∫—É—Ä—Å—É '–®–ª—è—Ö –¥–æ —Å–ø–æ–∫–æ—é: —è–∫ —à–≤–∏–¥–∫–æ –ø–æ–∑–±—É—Ç–∏—Å—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫'. –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –ø—ñ–¥—Å—É–º—É—î–º–æ –∑–Ω–∞–Ω–Ω—è —Ç–∞ —Ç–µ—Ö–Ω—ñ–∫–∏, —è–∫—ñ –≤–∏ –æ–ø–∞–Ω—É–≤–∞–ª–∏ –ø—ñ–¥ —á–∞—Å –Ω–∞–≤—á–∞–Ω–Ω—è, —ñ —Å—Ç–≤–æ—Ä–∏–º–æ –ø–ª–∞–Ω –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó —Ü–∏—Ö –Ω–∞–≤–∏—á–æ–∫ —É —Ç–≤–æ—î –ø–æ–≤—Å—è–∫–¥–µ–Ω–Ω–µ –∂–∏—Ç—Ç—è.",
        video: "https://youtu.be/sPv3oX8aQBU",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–¶–µ —â–µ –Ω–µ –≤—Å–µ. –ú–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ —Å—å–æ–≥–æ–¥–Ω—ñ –ø–æ—Ä–µ–ª–∞–∫—Å—É—î–º–æ!üßò‚Äç‚ôÄÔ∏è –Ø –Ω–∞–≤—á—É —Ç–µ–±–µ –∞–≤—Ç–æ—Ä—Å—å–∫—ñ–π –º–µ–¥–∏—Ç–∞—Ü—ñ—ó, —è–∫—É —è –Ω–∞–∑–≤–∞–ª–∞ '–ó—ñ—Ä–∫–∞'.",
        video: "https://youtu.be/pk8_7tBcRuU",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–Ü —Ü–µ —â–µ –Ω–µ –≤—Å–µ!‚ù§ –Ø –Ω–∞–≤—á—É —Ç–µ–±–µ —Ç–µ—Ö–Ω—ñ—Ü—ñ, —è–∫–∞ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è '–ü–æ–¥—è–∫–∞'. –¶—è —Ç–µ—Ö–Ω—ñ–∫–∞ –¥–æ–ø–æ–º–∞–≥–∞—î –Ω–µ —Ç—ñ–ª—å–∫–∏ –∑–∞—Å–ø–æ–∫–æ—ó—Ç–∏ –Ω–µ—Ä–≤–æ–≤—É —Å–∏—Å—Ç–µ–º—É, –∞–ª–µ –π —Ä–æ–∑–≤–∏–≤–∞—î –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –∫—Ä–∞—â–µ —Å–ø—Ä–∞–≤–ª—è—Ç–∏—Å—è –∑ —Ç—Ä–∏–≤–æ–≥–æ—é —Ç–∞ —Å—Ç—Ä–µ—Å–æ–≤–∏–º–∏ —Å–∏—Ç—É–∞—Ü—ñ—è–º–∏, —Å—Ç–≤–æ—Ä—é—é—á–∏ –±—ñ–ª—å—à –≥–∞—Ä–º–æ–Ω—ñ–π–Ω–µ —Å–ø—Ä–∏–π–Ω—è—Ç—Ç—è —Å–≤—ñ—Ç—É.",
        video: "https://youtu.be/dsTbpMFcXko",
        button: "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É",
      },
      {
        text: "–ö–æ—Ä–∏—Å–Ω–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª —É PDF:",
        pdf: "./files/grounding_guide.pdf",
      },
      {
        text: "–ü–µ—Ä–µ—Ö–æ–¥—å –¥–æ –±–æ–Ω—É—Å–Ω–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤! –Ø –ø—ñ–¥–≥–æ—Ç—É–≤–∞–ª–∞ –¥–ª—è —Ç–µ–±–µ —Ç—Ä–∏ –º—É–∑–∏—á–Ω—ñ –∫–æ–º–ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –º–µ–¥–∏—Ç–∞—Ü—ñ—ó. –ú–æ–∂–µ—à –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ó—Ö —Å–æ–±—ñ –Ω–∞ –ø—Ä–∏—Å—Ç—Ä—ñ–π —Ç–∞ –º–µ–¥–∏—Ç—É–≤–∞—Ç–∏ –≤ –±—É–¥—å-—è–∫–∏–π –∑—Ä—É—á–Ω–∏–π —á–∞—Å –¥–ª—è —Å–µ–±–µ!",
        audio: [
          "./audio/meditation1.mp3",
          "./audio/meditation2.mp3",
          "./audio/meditation3.mp3",
        ],
      },
      {
        text: "–í—ñ—Ç–∞—é —Ç–µ–±–µ —ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –∫—É—Ä—Å—É!",
      },
    ],
  },
];

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫—Ä–æ–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
const sendStep = async (chatId) => {
  const userState = usersState[chatId];

  if (!userState) return;

  const { day, step } = userState;
  const todayContent = courseContent.find((content) => content.day === day);

  if (!todayContent || !todayContent.steps[step]) {
    bot.sendMessage(
      chatId,
      "–¶–µ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ! –ü—Ä–æ–¥–æ–≤–∂–∏–º–æ –∑–∞–≤—Ç—Ä–∞. üòä"
    );
    return;
  }

  const currentStep = todayContent.steps[step];

  await bot.sendMessage(chatId, currentStep.text);

  if (currentStep.image) {
    await bot.sendPhoto(chatId, currentStep.image);
  }

  if (currentStep.video) {
    await bot.sendMessage(chatId, `–î–∏–≤–∏—Å—å –≤—ñ–¥–µ–æ —Ç—É—Ç: ${currentStep.video}`, {
      reply_markup: {
        inline_keyboard: [
          [{ text: currentStep.button, url: currentStep.video }],
        ],
      },
    });
  }

  if (currentStep.audio) {
    if (Array.isArray(currentStep.audio)) {
      for (const audio of currentStep.audio) {
        await bot.sendAudio(chatId, audio);
      }
    } else {
      await bot.sendAudio(chatId, currentStep.audio);
    }
  }

  if (currentStep.pdf) {
    await bot.sendDocument(chatId, currentStep.pdf);
  }

  if (currentStep.form) {
    await bot.sendMessage(chatId, `–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É —Ç—É—Ç: ${currentStep.form}`);
  }

  if (todayContent.steps[step + 1]) {
    await bot.sendMessage(chatId, "–ö–æ–ª–∏ –±—É–¥–µ—à –≥–æ—Ç–æ–≤–∏–π, –Ω–∞—Ç–∏—Å–Ω–∏ '–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏'!", {
      reply_markup: {
        inline_keyboard: [[{ text: "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏", callback_data: "continue" }]],
      },
    });
  }
};
// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;

  if (usersState[chatId]) {
    bot.sendMessage(chatId, "–í–∏ –≤–∂–µ –ø–æ—á–∞–ª–∏ –∫—É—Ä—Å!");
    return;
  }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Å—Ç–∞–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  usersState[chatId] = { day: 1, step: 0 };

  bot.sendMessage(
    chatId,
    "–ü—Ä–∏–≤—ñ—Ç! –í—ñ—Ç–∞—é –≤–∞—Å –Ω–∞ –∫—É—Ä—Å—ñ '–®–ª—è—Ö –¥–æ —Å–ø–æ–∫–æ—é: —è–∫ —à–≤–∏–¥–∫–æ –ø–æ–∑–±—É—Ç–∏—Å—è –ø–∞–Ω—ñ—á–Ω–∏—Ö –∞—Ç–∞–∫'! üòä"
  );

  // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–µ—Ä—à–∏–π –∫—Ä–æ–∫
  sendStep(chatId);
});

// –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"
bot.on("callback_query", (query) => {
  const chatId = query.message.chat.id;

  if (query.data === "continue") {
    // –ó–±—ñ–ª—å—à—É—î–º–æ –∫—Ä–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    usersState[chatId].step += 1;

    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫
    sendStep(chatId);
  }
});
